(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[789],{5781:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle/[battleId]",function(){return n(8391)}])},162:function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,s=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(o){a=!0,s=o}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.default=void 0;var a,s=(a=n(2784))&&a.__esModule?a:{default:a},i=n(9918),l=n(3642),o=n(2030);var c={};function u(e,t,n,r){if(e&&i.isLocalURL(t)){e.prefetch(t,n,r).catch((function(e){0}));var a=r&&"undefined"!==typeof r.locale?r.locale:e&&e.locale;c[t+"%"+n+(a?"%"+a:"")]=!0}}var d=function(e){var t,n=!1!==e.prefetch,a=l.useRouter(),d=s.default.useMemo((function(){var t=r(i.resolveHref(a,e.href,!0),2),n=t[0],s=t[1];return{href:n,as:e.as?i.resolveHref(a,e.as):s||n}}),[a,e.href,e.as]),f=d.href,h=d.as,m=e.children,p=e.replace,g=e.shallow,v=e.scroll,y=e.locale;"string"===typeof m&&(m=s.default.createElement("a",null,m));var b=(t=s.default.Children.only(m))&&"object"===typeof t&&t.ref,x=r(o.useIntersection({rootMargin:"200px"}),2),j=x[0],_=x[1],N=s.default.useCallback((function(e){j(e),b&&("function"===typeof b?b(e):"object"===typeof b&&(b.current=e))}),[b,j]);s.default.useEffect((function(){var e=_&&n&&i.isLocalURL(f),t="undefined"!==typeof y?y:a&&a.locale,r=c[f+"%"+h+(t?"%"+t:"")];e&&!r&&u(a,f,h,{locale:t})}),[h,f,_,y,n,a]);var w={ref:N,onClick:function(e){t.props&&"function"===typeof t.props.onClick&&t.props.onClick(e),e.defaultPrevented||function(e,t,n,r,a,s,l,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&i.isLocalURL(n))&&(e.preventDefault(),null==l&&r.indexOf("#")>=0&&(l=!1),t[a?"replace":"push"](n,r,{shallow:s,locale:o,scroll:l}))}(e,a,f,h,p,g,v,y)},onMouseEnter:function(e){t.props&&"function"===typeof t.props.onMouseEnter&&t.props.onMouseEnter(e),i.isLocalURL(f)&&u(a,f,h,{priority:!0})}};if(e.passHref||"a"===t.type&&!("href"in t.props)){var S="undefined"!==typeof y?y:a&&a.locale,I=a&&a.isLocaleDomain&&i.getDomainLocale(h,S,a&&a.locales,a&&a.domainLocales);w.href=I||i.addBasePath(i.addLocale(h,S,a&&a.defaultLocale))}return s.default.cloneElement(t,w)};t.default=d},2030:function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,s=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(o){a=!0,s=o}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0}),t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,o=a.useRef(),c=r(a.useState(!1),2),u=c[0],d=c[1],f=a.useCallback((function(e){o.current&&(o.current(),o.current=void 0),n||u||e&&e.tagName&&(o.current=function(e,t,n){var r=function(e){var t=e.rootMargin||"",n=l.get(t);if(n)return n;var r=new Map,a=new IntersectionObserver((function(e){e.forEach((function(e){var t=r.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return l.set(t,n={id:t,observer:a,elements:r}),n}(n),a=r.id,s=r.observer,i=r.elements;return i.set(e,t),s.observe(e),function(){i.delete(e),s.unobserve(e),0===i.size&&(s.disconnect(),l.delete(a))}}(e,(function(e){return e&&d(e)}),{rootMargin:t}))}),[n,t,u]);return a.useEffect((function(){if(!i&&!u){var e=s.requestIdleCallback((function(){return d(!0)}));return function(){return s.cancelIdleCallback(e)}}}),[u]),[f,u]};var a=n(2784),s=n(9071),i="undefined"!==typeof IntersectionObserver;var l=new Map},7418:function(e,t,n){"use strict";n.d(t,{E:function(){return h}});var r=n(2322),a=n(2784),s=n(9097),i=n(1453),l=n(9387),o=function(e){var t=e.imageUrl,n=e.actionLink,a=e.timeStamp,s=e.children,i=(0,r.jsx)("svg",{style:{width:"30px",height:"30px"},viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"currentColor",d:"M12 19.2c-2.5 0-4.71-1.28-6-3.2.03-2 4-3.1 6-3.1s5.97 1.1 6 3.1a7.232 7.232 0 0 1-6 3.2M12 5a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-3A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10z"})});return(0,r.jsxs)("div",{className:"notification-item",children:[(0,r.jsxs)("div",{className:"notification-item__content",children:[(0,r.jsx)("div",{className:"notification-item__image",children:t?(0,r.jsx)("img",{src:t,alt:""}):i}),(0,r.jsxs)("div",{className:"notification-item__text",children:[s,(0,r.jsxs)("div",{className:"notification-item__time",children:[(0,l.VG)(a)," ago"]})]})]}),n?(0,r.jsx)("a",{href:n,className:"shadow-link"}):null]})},c=n(7037),u=n(4136),d=n.n(u),f=n(9241);function h(e){var t=e.battleId,n=(0,a.useState)(!1),l=n[0],u=n[1],h=(0,a.useState)([]),m=h[0],p=h[1];return(0,a.useEffect)((function(){u(!0),(0,c.V6)(t).then((function(e){u(!1),p(e)}))}),[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.M,{children:"Activity Timeline"}),(0,r.jsx)("div",{className:"item__content item__content--no-padding",children:(0,r.jsxs)("div",{className:d().streams,children:[l?(0,r.jsx)("p",{className:"para ta-c",style:{margin:"1rem 0"},children:(0,r.jsx)(f.a,{})}):null,l||m.length?null:(0,r.jsx)("p",{className:"para ta-c",children:"No activity recorded here."}),!l&&m.map((function(e){return(0,r.jsxs)(o,{timeStamp:e.timestamp,imageUrl:e.playerProfile.avatar,children:[e.playerProfile.displayName," ",e.data.userId===e.data.previousUserId?"broke own record on":"set a new record on"," ",(0,r.jsx)(s.default,{href:"/play/".concat(e.data.levelId),children:(0,r.jsxs)("a",{className:"link",children:["Target #",e.data.levelId]})})," ","with ",e.data.codeSize," chars (",e.data.codeSize-e.data.previousUserCodeSize,")."]},e.id)}))]})})]})}},2220:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var r=n(2322),a=(n(2784),n(9241));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e){var t=e.type,n=void 0===t?"button":t,l=e.primary,o=e.danger,c=e.extraClasses,u=void 0===c?"":c,d=e.children,f=e.isLoading,h=i(e,["type","primary","danger","extraClasses","children","isLoading"]);return(0,r.jsxs)("button",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}({type:n,className:"button ".concat(l?"button--primary":""," ").concat(o?"button--danger":""," ").concat(u)},h,{children:[d," ",f&&(0,r.jsx)(a.a,{})]}))}},1551:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var r=n(2322),a=n(2784),s=n(9387),i=n(1251);function l(e){var t=e.count,n=e.label;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"countdown__number",children:t}),n,1===t?"":"s"]})}function o(e){var t=e.date,n=e.prefix,o=void 0===n?"":n,c=e.suffix,u=void 0===c?"remaining":c,d=e.separator,f=void 0===d?" : ":d,h=e.hideSeconds,m=void 0!==h&&h,p=e.onFinish,g=function(){var e=Date.now();if(e>new Date(t))"function"===typeof p&&p();else{var n=(0,s.hM)(e,t);b(n)}},v=(0,a.useState)({}),y=v[0],b=v[1];return(0,a.useEffect)((function(){g();var e=setInterval(g,1e3);return function(){clearInterval(e)}}),[t]),(0,r.jsxs)("div",{className:"countdown",children:[(0,r.jsx)(i.dy,{label:"watch",children:"\u23f0"}),o?" ".concat(o," "):null,y.days?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{label:"day",count:y.days}),f]}):null," ",y.hours?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{label:"hour",count:y.hours}),f]}):null," ",y.minutes?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{label:"minute",count:y.minutes}),m?"":f]}):null," ",m?null:(0,r.jsx)(l,{label:"second",count:y.seconds}),u?" ".concat(u):null]})}},1942:function(e,t,n){"use strict";n.d(t,{N:function(){return a}});var r=n(2322);function a(){return(0,r.jsxs)("div",{className:"friends-empty",children:[(0,r.jsx)("img",{alt:"Two friends high fiving",src:"/images/friends.svg"}),(0,r.jsx)("p",{className:"friends-empty__title",children:"Add friends!"}),(0,r.jsx)("p",{className:"friends-empty__desc",children:"Want to see where you stand only among your friends? Visit their profile and add them as friends to see them here!"})]})}},8742:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(2322),a=(n(2784),n(9387)),s=n(1251);function i(e){var t=e.data;return(0,r.jsxs)("div",{className:"leaderboard__user  leaderboard__user--".concat(t.rank),children:[(0,r.jsx)(s.qE,{small:!0,size:"32",url:t.playerProfile.avatar,username:t.playerProfile.username,userId:t.userId||t.playerProfile.id,className:"leaderboard__user-avatar"}),(0,r.jsxs)("div",{className:"leaderboard__user-info",children:[(0,r.jsx)(s.Rj,{name:t.playerProfile.displayName,username:t.playerProfile.username,isPro:t.playerProfile.isPro,userId:t.userId||t.playerProfile.id,className:"leaderboard__user-name",ellipsis:!0}),(0,r.jsxs)("p",{className:"leaderboard__user-score",children:[t.score?t.score.toFixed(2):"0"," ",t.playedCount?"(".concat(t.playedCount," Target").concat(t.playedCount>1?"s":"",")"):"",t.codeSize?"(".concat(t.codeSize," Chars)"):""]})]}),(0,r.jsx)("p",{className:"leaderboard__user-rank  leaderboard__user-rank--".concat(t.rank),children:(0,a.x4)(t.rank)})]})}},94:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var r=n(2322),a=n(3290);function s(e){var t=e.isFriendsMode,n=e.onChange,s=function(e){n(e),(0,a.q)({name:"friendLeaderboardToggle",label:"friends"===e.target.value})};return(0,r.jsxs)("div",{className:"filter leaderboard-filter",children:[(0,r.jsxs)("span",{className:"filter__button",children:[(0,r.jsx)("input",{type:"radio",name:"leaderboard-filter",id:"friends",value:"friends",defaultChecked:t,onChange:s}),(0,r.jsx)("label",{htmlFor:"friends",children:"Friends Only"})]}),(0,r.jsxs)("span",{className:"filter__button",children:[(0,r.jsx)("input",{type:"radio",name:"leaderboard-filter",id:"everyone",value:"everyone",defaultChecked:!t,onChange:s}),(0,r.jsx)("label",{htmlFor:"everyone",children:"All Players"})]})]})}},1453:function(e,t,n){"use strict";n.d(t,{M:function(){return a}});var r=n(2322);n(2784);function a(e){var t=e.children,n=e.sticky,a=e.keyCombo,s=e.meta;return(0,r.jsxs)("div",{className:"item__header  ".concat(n?"item__header--sticky":""),children:[(0,r.jsx)("h3",{className:"header__title",children:t}),a&&(0,r.jsxs)("p",{className:"key-combo key-combo--header",children:[" ",a," "]}),(0,r.jsx)("div",{className:"header__extra-info",children:s})]})}},9318:function(e,t,n){"use strict";n.d(t,{_:function(){return a}});var r=n(2784);function a(e,t){var n=(0,r.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),a=n[0],s=n[1];return[a,function(t){try{var n=(r=t,(null!=(i=Function)&&"undefined"!==typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](r):r instanceof i)?t(a):t);s(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(l){console.log(l)}var r,i}]}},8391:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return V}});var r=n(2322),a=n(2784),s=n(5632),i=n(7729),l=n(7500),o=n(4697),c=n(7171),u=n(1453),d=n(7037),f=n(8742),h=n(3552),m=n(9241),p=n(9318),g=n(94),v=n(1942);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){y(e,t,n[t])}))}return e}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,s=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(o){a=!0,s=o}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _=function(e){var t=e.title,n=e.battleId,s=e.numOfPlayersToShow,i=void 0===s?10:s,o=(0,a.useContext)(h.S),c=(0,a.useState)([]),y=c[0],_=c[1],N=(0,a.useState)({}),w=N[0],S=N[1],I=(0,a.useState)(),k=I[0],O=I[1],P=x((0,p._)("showFriendsLeaderboard",!!o),2),C=P[0],B=P[1],E=(0,l.checkIfCustomBattle)({id:n}),F=(0,a.useState)({battlePlayerCount:{}}),L=F[0],T=F[1];return(0,a.useEffect)((function(){(0,d.pc)().then(T)}),[]),(0,a.useEffect)((function(){O(!0),_([]),S({}),(C&&o?(0,d.eL)({battleId:n,userId:o.uid}):(0,d.uL)({battleId:n,numOfPlayers:i})).then((function(e){_(e),O(!1),o&&e.length&&(e.find((function(e){return e.id===o.uid}))?S({rank:e.findIndex((function(e){return e.id===o.uid}))+1}):(0,d.r8)({userId:o.uid,battleId:n}).then((function(t){S(t),_(j(e).concat([{score:t.score,playerProfile:b({},o,{avatar:o.photoURL}),id:o.uid,rank:t.rank,playedCount:t.playedCount}]))})).catch((function(e){console.log("failed to fetch rank")})))}))}),[o?o.uid:"",n,C]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.M,{meta:"You: ".concat(w.rank||"-","/").concat(C?y.length:L.battlePlayerCount[n]||"-"),children:t}),(0,r.jsxs)("div",{className:"item__content",children:[o&&(0,r.jsx)(g.g,{isFriendsMode:C,onChange:function(e){B("friends"===e.target.value)}}),C&&!k&&!y.length&&(0,r.jsx)(v.N,{}),0===w.rank&&(0,r.jsx)("p",{className:"section-helper section-helper--no-score",children:"Play at least 1 target to see your rank."}),(0,r.jsxs)("div",{className:"leaderboard-container",children:[k?(0,r.jsx)("p",{className:"ta-c",children:(0,r.jsx)(m.a,{})}):null,!k&&!y.length&&!C&&(0,r.jsx)("p",{className:"para",children:"No one here. It could be you! How about playing some targets?"}),(0,r.jsx)("ol",{className:"leaderboard__user-list",children:y.map((function(e,t){return(0,r.jsx)("li",{children:(0,r.jsx)(f.P,{data:b({},e,{rank:void 0===e.rank?t+1:e.rank})},t)},t)}))})]}),y.length?(0,r.jsxs)("p",{className:"para leaderboard-buttons",children:[(0,r.jsx)("a",{href:"/leaderboard/battle/".concat(n),className:"button",children:"See top 100"}),!E&&(0,r.jsx)("a",{href:"/leaderboard",className:"button",style:{marginLeft:"1rem"},children:"All-time leaderboard"})]}):null]})]})},N=n(9097),w=n(1251);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){var t=e.data,n=e.playerData,s=void 0===n?{}:n,i=e.stats,l=(0,a.useContext)(h.S);t.image=t.id?t.image:"/targets/0.png?v=2";var o=t.image.replace(/\.png/,"@2x.png");return(0,r.jsxs)("div",{className:"target-tile ".concat(t.id?"":"target-tile--dummy"," ").concat(t.isOpen?"target-tile--public":""),children:[t.id&&(0,r.jsx)(N.default,{href:"/play/".concat(t.id),children:(0,r.jsx)("a",{className:"shadow-link",title:"Play target number ".concat(t.id)})}),(0,r.jsx)("img",{src:t.image,srcSet:"".concat(o," 2x"),alt:"",loading:"lazy",className:"target-tile__image"}),(0,r.jsxs)("div",{className:"target-tile__info",children:[(0,r.jsxs)("div",{className:"target-top-info",children:[t.id?(0,r.jsx)("p",{className:"target-top-info__pill",children:t.id.length>5&&t.name||"#".concat(t.id)}):null,t.isOpen?(0,r.jsx)("p",{className:"target-top-info__pill",children:(0,r.jsx)("img",{alt:"",src:"/images/open-book.svg"})}):null]}),(0,r.jsx)("div",{className:"target-highscore",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"target-highscore__right",children:[(0,r.jsx)("div",{className:"target-highscore__username",children:(0,r.jsx)(w.Rj,{name:i.highscore.playerProfile.displayName,username:i.highscore.playerProfile.username,userId:i.highscore.playerProfile.userId,isPro:i.highscore.playerProfile.isPro,ellipsis:!0})}),(0,r.jsxs)("p",{className:"target-highscore__score",children:[i.highscore.score," ",(0,r.jsxs)("span",{children:["{",i.highscore.codeSize,"}"]})]})]}),(0,r.jsx)(w.qE,{small:!0,size:"40",url:i.highscore.playerProfile.avatar,userId:i.highscore.playerProfile.userId,username:i.highscore.playerProfile.username,className:"target-highscore__avatar"})]}):"No highscore available"}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"target-tile-header",children:"Your Stats"}),(0,r.jsx)("div",{className:"target-attempts",children:(0,r.jsxs)("p",{className:"target-attempts__item target-attempts__item--score",children:["Score:",(0,r.jsxs)("span",{children:[s.score||"N/A"," ",(0,r.jsxs)("span",{children:["{",s.codeSize||"-","}"]})]})]})})]})]}),t.isOpen?(0,r.jsx)("div",{className:"public-target-message",children:(0,r.jsxs)("p",{children:['This is an "Open" Target. Open Targets have all the top solutions public.'," ",(0,r.jsx)("a",{className:"link",href:"/blog/introducing-open-targets/",children:"Learn More"})]})}):null]})}function k(e){var t=(0,a.useState)(),n=t[0],s=t[1];return(0,a.useEffect)((function(){if(s(),e.data.id){var t=e.data.id;return(0,d.GT)(e.data.id).then((function(n){t===e.data.id&&s(n)})),function(){t=null}}}),[e.data.id]),(0,r.jsx)(I,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){S(e,t,n[t])}))}return e}({},e,{stats:n}))}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}var C="all",B="played",E="notPlayed";function F(e){var t=e.battle,n=function(e){x(e.target.value)},s=(0,a.useContext)(h.S),i=(0,a.useState)([]),l=i[0],o=i[1],c=(0,a.useState)(),f=c[0],m=c[1],p=(0,a.useState)(0),g=p[0],v=p[1],y=(0,a.useState)(C),b=y[0],x=y[1];return(0,a.useEffect)((function(){(0,d.TU)(t.levelIds).then(o)}),[t.id]),(0,a.useEffect)((function(){v(0),m(),s&&(0,d.HC)({userId:s.uid,levelIds:t.levelIds}).then((function(e){v(Object.keys(e).length),m(e)}))}),[s?s.uid:"",t.id]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.M,{sticky:!0,meta:s?(0,r.jsx)("div",{children:(0,r.jsxs)("span",{className:"filter",children:[(0,r.jsxs)("span",{className:"filter__button",children:[(0,r.jsx)("input",{defaultChecked:!0,type:"radio",name:"filter",id:"all",value:C,onChange:n}),(0,r.jsxs)("label",{htmlFor:"all",children:["All (","".concat(t.levelIds.length),")"]})]}),(0,r.jsxs)("span",{className:"filter__button",children:[(0,r.jsx)("input",{type:"radio",name:"filter",id:"played",value:B,onChange:n}),(0,r.jsxs)("label",{htmlFor:"played",children:["Played (","".concat(g),")"]})]}),(0,r.jsxs)("span",{className:"filter__button",children:[(0,r.jsx)("input",{type:"radio",name:"filter",id:"notPlayed",value:E,onChange:n}),(0,r.jsxs)("label",{htmlFor:"notPlayed",children:["Not yet played (","".concat(l.length-g),")"]})]})]})}):null,children:["Battle ",(0,r.jsx)(w.bN,{id:t.id})," - ",t.name]}),(0,r.jsx)("div",{className:"item__content",children:(0,r.jsx)("div",{className:"targets-container",children:l.map((function(e,n){return b===C||b===B&&f[e.id]||b===E&&!f[e.id]?(0,r.jsx)(k,{data:P({},e,{id:e.id,isOpen:!(!t.openLevelIds||!t.openLevelIds.includes(e.id))}),playerData:f?f[e.id]:void 0},n):null}))})})]})}var L=n(2021),T=n.n(L),M=n(3029),A=n(1551),D=n(1893),H=n(3290),z=n(2220),G=n(3181),R=n(9387);function U(e,t,n,r,a,s,i){try{var l=e[s](i),o=l.value}catch(c){return void n(c)}l.done?t(o):Promise.resolve(o).then(r,a)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){U(s,r,a,i,l,"next",e)}function l(e){U(s,r,a,i,l,"throw",e)}i(void 0)}))}}function W(e){return e.endDate||+new Date(1e3*e.startDate.seconds)+60*e.duration*1e3}function Y(e){var t=e.battle,n=function(){return i&&(!i.settings||!i.settings.emailNotifications)&&!1!==f},s=function(){v((0,l.getBattleStatus)(t))},i=(0,D.a)(),o=(0,G.k6)(),c=(0,a.useState)(),f=c[0],h=c[1],m=(0,l.checkIfCustomBattle)(t),p=(0,a.useState)((0,l.getBattleStatus)(t)),g=p[0],v=p[1],y=(0,a.useState)(!1),b=y[0],x=y[1];function j(e){return _.apply(this,arguments)}function _(){return(_=q(T().mark((function e(n){var r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=6;break}return e.next=3,i.getIdToken();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0="";case 7:if(r=e.t0){e.next=10;break}return e.abrupt("return");case 10:return x(!0),e.abrupt("return",fetch("".concat(d.bl,"/").concat(n===l.BattleStatuses.ONGOING?"startBattle":"stopBattle","?token=").concat(r,"&battleId=").concat(t.id)).then((function(e){return x(!1),e})));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=q(T().mark((function e(){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:if(t.levelIds.length){e.next=4;break}return e.abrupt("return",window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle."));case 4:if(window.confirm("You cannot edit or restart a battle once it is started. Are you sure you want to start this battle?")){e.next=7;break}return e.abrupt("return");case 7:j(l.BattleStatuses.ONGOING).then(q(T().mark((function e(t){var n;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=4;break}return(0,R.lC)(3),v(l.BattleStatuses.ONGOING),e.abrupt("return");case 4:return e.next=6,t.json();case 6:if("insufficientCredits"!==(n=e.sent).error){e.next=13;break}return window.confirm("You have insufficient credits to start this custom battle. Click OK to proceed to buying credits.")&&o.push("/settings?tab=custom-battle-credits"),e.abrupt("return");case 13:if("noTargetsFound"!==n.error){e.next=16;break}return window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle."),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})))).catch((function(e){x(!1),alert("Battle could not be started. Try one more time, otherwise DM us on twitter: @css_battle")}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return a.useEffect((function(){v((0,l.getBattleStatus)(t))}),[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.M,{children:[t.type?t.type===l.BattleTypes.BIG_BATTLE?"Big":"Mini":"Custom"," ","Battle"]}),(0,r.jsxs)("div",{className:"homepage-banner",children:[(0,r.jsxs)("div",{className:"d-if",style:{alignItems:"center",marginBottom:"0.25rem"},children:[(0,r.jsxs)("h1",{className:"homepage-banner__heading",style:{marginBottom:"0",marginRight:"1rem"},children:["Battle ",(0,r.jsx)(w.bN,{id:t.id})," - ",t.name]}),(0,r.jsx)(M.k,{status:g})]}),(0,r.jsxs)("div",{className:"homepage-banner__description battle-banner__description",children:[t.description?(0,r.jsxs)("p",{className:"para",children:[t.description," ",t.sponsor?(0,r.jsxs)(r.Fragment,{children:["Sponsored by"," ",(0,r.jsx)("a",{className:"link",href:t.sponsor.link,children:t.sponsor.name}),".",t.rewards?" The following rewards will be given to players at the end of the Battle.":null]}):null]}):null,t.rewards?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"battle-rewards",children:[t.rewards.gold?(0,r.jsx)("div",{className:"reward-tile reward-tile--gold",children:t.rewards.gold}):null,t.rewards.silver?(0,r.jsx)("div",{className:"reward-tile reward-tile--silver",children:t.rewards.silver}):null,t.rewards.bronze?(0,r.jsx)("div",{className:"reward-tile reward-tile--bronze",children:t.rewards.bronze}):null,t.rewards.others?(0,r.jsx)("div",{className:"reward-tile reward-tile--regular",children:t.rewards.others}):null]}),(0,r.jsx)("p",{style:{fontSize:"12px",marginTop:"-30px"},children:t.rewards.note})]}):null]}),g===l.BattleStatuses.UPCOMING&&t.startDate?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,r.jsx)(A.W,{date:t.startDate,onFinish:s})}),(0,r.jsxs)("p",{className:"para",children:["Starting on ",new Date(t.startDate).toLocaleString()]})]}):null,g===l.BattleStatuses.FINISHED&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"para",style:{marginLeft:"2rem",marginRight:"2rem"},children:m?"This Battle has finished. But you can always play the targets below. Note: Custom battle targets don't  contribute to your global ranking.":"This Battle has finished. But you can always play the targets below and improve your global ranking!"}),n()&&(0,r.jsx)(z.z,{primary:!0,onClick:function(){h(!0),(0,H.q)({name:"emailNotificationUpdated",label:1}),(0,d.Ii)(i.uid,{"settings.emailNotifications":!0}).then((function(){h(!1)}))},isLoading:f,children:"Get Notified via Email about new Battles"}),!1===f?(0,r.jsx)("p",{className:"para",children:"Great! We'll notify you about coming Battles."}):null,n()&&(0,r.jsx)("p",{className:"small",style:{margin:"2rem 2rem 0",color:"var(--clr-text-light)"},children:"With this, you'll also receive future emails from us regarding such announcements. We won't spam you :)"})]}),g===l.BattleStatuses.ONGOING&&t.startDate?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"para",children:["Battle ends on ",new Date(W(t)).toLocaleString()]}),(0,r.jsx)(w.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,r.jsx)(A.W,{date:W(t),onFinish:s})})]}):null,!i&&(0,r.jsx)("p",{children:(0,r.jsx)("a",{className:"button",href:"/login",children:"Sign In / Sign Up"})}),i&&i.uid===t.createdBy?(0,r.jsxs)(w.hE,{center:!0,children:[g===l.BattleStatuses.UPCOMING?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.z,{primary:!0,onClick:function(){return N.apply(this,arguments)},isLoading:b,children:"Start Battle"}),(0,r.jsx)("a",{className:"link",href:"/battle/create/".concat(t.id),children:"Edit"})]}):null,g===l.BattleStatuses.ONGOING?(0,r.jsx)(z.z,{danger:!0,onClick:function(){window.confirm("You cannot restart a battle once it is stopped. Are you sure you want to stop this battle?")&&j(l.BattleStatuses.FINISHED).then(q(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=3;break}return v(l.BattleStatuses.FINISHED),e.abrupt("return");case 3:case"end":return e.stop()}}),e)})))).catch((function(e){x(!1),alert("Battle could not be stopped. Try one more time, otherwise DM us on twitter: @css_battle")}))},isLoading:b,children:"Stop Battle"}):null]}):null]})]})}var K=n(7418),X=n(3781),J=n.n(X),V=function(){var e=(0,s.useRouter)(),t=(0,a.useContext)(h.S),n=(0,a.useState)(!1),u=(n[0],n[1]),f=(0,a.useState)(),p=f[0],g=f[1];(0,a.useEffect)((function(){if(e.isReady){var t=e.query.battleId,n=(0,R.NR)(t);u(n),g(n?t:parseInt(t,10))}}),[e.isReady,e.query.battleId]);var v=(0,a.useState)(),y=v[0],b=v[1];return(0,a.useEffect)((function(){p&&(0,d.ch)(p).then((function(e){(0,l.getBattleStatus)(e)!==l.BattleStatuses.UPCOMING||t&&e.createdBy===t.uid||(e.levelIds=e.levelIds.map((function(){return 0}))),b(e)}))}),[p]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.default,{children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("meta",{property:"og:title",content:"Battle #".concat(y.id,": ").concat(y.name," - CSSBattle")},"ogTitle"),(0,r.jsx)("title",{children:"Battle #".concat(y.id,": ").concat(y.name," - CSSBattle")},"title")]}):null}),(0,r.jsx)(o.h,{battleId:p,battleName:y?y.name:""}),y?(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("div",{className:"container__item container__item--main container__item--targets",children:[(0,r.jsx)(Y,{battle:y}),(0,r.jsx)(F,{battle:y})]}),(0,r.jsx)("div",{className:"container__item container__item--aside container__item--sticky",children:y?(0,r.jsxs)("div",{className:J().halfAndHalf,children:[(0,r.jsx)("div",{children:(0,r.jsx)(_,{title:"Battle Leaderboard",battleId:y.id})}),(0,r.jsx)("div",{children:(0,r.jsx)(K.E,{battleId:y.id})})]}):null})]}):(0,r.jsx)("div",{className:"container",children:(0,r.jsx)("div",{className:"container__item container__item--main",children:(0,r.jsx)(m.R,{children:"Fetching battle details..."})})}),(0,r.jsx)(c.$,{})]})}},4136:function(){},3781:function(e){e.exports={halfAndHalf:"Homepage_halfAndHalf__aOimb",customBattle:"Homepage_customBattle__3KfvQ",customBattleHighlighted:"Homepage_customBattleHighlighted__q5lok",customBattle_flex:"Homepage_customBattle_flex__IXjFX",customBattle_name:"Homepage_customBattle_name__2rMne",buttons:"Homepage_buttons__F_DrG",viewButton:"Homepage_viewButton__lw8eP",homepageTopFlex:"Homepage_homepageTopFlex__Iw16L",liveCounterContainer:"Homepage_liveCounterContainer____qrE",liveCounter:"Homepage_liveCounter__0oZ7g",liveCounterEmoji:"Homepage_liveCounterEmoji__xMfRJ"}},9097:function(e,t,n){e.exports=n(162)},1665:function(e,t,n){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.d(t,{Z:function(){return r}})}},function(e){e.O(0,[181,836,774,888,179],(function(){return t=5781,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[battleId]-ba54b36f8600f07e.js.map